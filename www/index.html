<!DOCTYPE html>
<html>
<head>
    <!--
        Customize this policy to fit your own app's needs. For more guidance, see:
            https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
        Some notes:
            * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
            * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
            * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
                * Enable inline JS: add 'unsafe-inline' to default-src
        
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;">
-->
    <!-- Required meta tags-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <!-- Color theme for statusbar -->
    <!-- <meta name="theme-color" content="#2196f3"> -->
    <meta name="color-scheme" content="light dark">

    <!-- Your app title -->
    <title>My App</title>
    <!-- Path to Framework7 Library CSS -->
    <link rel="stylesheet" href="lib/framework7/framework7-bundle.css">
    <!-- Path to icons -->
    <link rel="stylesheet" href="css/icons.css">
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="css/app.css">
</head>

<body class="bg-color-teal">
    <div id="app">
        <!-- Statusbar overlay -->
        <div class="statusbar"></div>
    
        <!-- Your main view, should have "view-main" class -->
        <div class="view view-main">
       
            <!-- Top Navbar -->
            <div class="navbar">
                <div class="navbar-bg bg-color-lightblue"></div>
                <div class="navbar-inner text-color-white">
                    <div class="left"><i class="icon icon-back"></i></div>
                    <div class="title">Hy-Drate</div>
                    <div class="right"><i class="icon icon-forward"></i></div>
                </div>
            </div>
    
            <!-- Toolbar -->
            <div class="toolbar toolbar-bottom bg-color-lightblue">
                <div class="toolbar-inner">
                <!-- Toolbar links -->
                <a href="#" data-popup=".ubicacion" class="link text-color-white popup-open">Puntos Destacados</a>
                    <div class="popup ubicacion">
                        <div class="view">
                            <div class="page">
                                <div class="navbar">
                                    <div class="navbar-bg"></div>
                                    <div class="navbar-inner">
                                        <div class="title">Puntos Destacados</div>
                                        <div class="right">
                                            <!-- Link to close popup -->
                                            <a class="link popup-close">Close</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="page-content">
                                    <a href="https://goo.gl/maps/4PfbQL2cpNv6gFBp6" class="link"> Su ubicacion</a>

                                </div>
                            </div>
                        </div>
                    </div>
                
                <a href="index.html" class="link text-color-white">Link 2</a>
                </div>
            </div>
        
        <!-- Initial Page, "data-name" contains page name -->
            <div data-name="index" class="page bg-color-blue">
                <!-- Scrollable page content -->
                <div class="page-content">
                    <div class="block">
                        
                        <!-- CONTENIDO DEMO -->
                        
                        <p class="text-color-white">Bienvenido a Hy-Drate, su mapa virtual de puntos de recarga</p>
                        <!-- Link to another page -->
                        <a class="color-theme-white button button-outline" href="/about/">Sobre Nosotros</a>

                        <!-- In data-popup attribute we specify CSS selector of popup we need to open -->
                        <p><a href="#" data-popup=".my-popup" class="popup-open color-theme-white button button-outline">Open Popup</a></p>

                        <!-- And somewhere in DOM -->
                        <div class="popup my-popup">
                            <div class="view">
                                <div class="page">
                                    <div class="navbar">
                                        <div class="navbar-bg"></div>
                                        <div class="navbar-inner">
                                            <div class="title">Popup</div>
                                            <div class="right">
                                                <!-- Link to close popup -->
                                                <a class="link popup-close">Close</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="page-content">
                                      ...
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FIN DE DEMO -->
                        
                        
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-firestore.js"></script>


    <script>
        
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBED9YOX3LROIP1ag5ArhFUqYnBCT55C48",
        authDomain: "proyecto-programacion-b7218.firebaseapp.com",
        projectId: "proyecto-programacion-b7218",
        storageBucket: "proyecto-programacion-b7218.appspot.com",
        messagingSenderId: "873121118167",
        appId: "1:873121118167:web:b3a948ca622ff10e94bd92"
        };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>


<script>
    
    // cada un@ pone su magia para recuperar el mail y la clave de un form...
    var emailDelUser = "elvalor@delmail.com";
    var passDelUser = "1234567890";

firebase.auth().signInWithEmailAndPassword(emailDelUser, passDelUser)
  .then((userCredential) => {
    // Signed in
    var user = userCredential.user;

    console.log("Bienvenid@!!! " + emailDelUser);
    // ...
  })
  .catch((error) => {
    var errorCode = error.code;
    var errorMessage = error.message;

    console.error(errorCode);
        console.error(errorMessage);
  });


    // cada un@ pone su magia para recuperar el mail y la clave de un form...
    var emailDelUser = "elvalor@delmail.com";
    var passDelUser = "1234567890";


    firebase.auth().createUserWithEmailAndPassword(emailDelUser, passDelUser)
      .then((userCredential) => {
        // Signed in
        var user = userCredential.user;
        console.log("Bienvenid@!!! " + emailDelUser);
        // ...
        mainView.router.navigate('/siguientePantallaDeUsuarioOK/');
      })
      .catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;

        console.error(errorCode);
        console.error(errorMessage);

        if (errorCode == "auth/email-already-in-use") {
            console.error("el mail ya esta usado");
        }

        // ..
      });


      var emailDelUser="";

var db = firebase.firestore();
var colUsuario = db.collection("Usuarios");



function fnLogin() {

    emailDelUser = $$('#lEmail').val();
    passDelUser = $$('#lPass').val();

    firebase.auth().signInWithEmailAndPassword(emailDelUser, passDelUser)
      .then((userCredential) => {
        // Signed in
        var user = userCredential.user;

        console.log("Bienvenid@!!! " + emailDelUser);

        claveDeColeccion = emailDelUser;

        var docRef = colUsuario.doc(claveDeColeccion);

        docRef.get().then((doc) => {
            if (doc.exists) {
                console.log("Document data:", doc.data());

                console.log(doc.id);
                console.log(doc.data().nombre);
                console.log(doc.data().rol);

                if (doc.data().rol == "admin") {
                    mainView.router.navigate('/panelAdmin/');
                } else {
                    mainView.router.navigate('/panelUsuario/');
                }


            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }
        }).catch((error) => {
            console.log("Error getting document:", error);
        });


        // ...
      })
      .catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;

        console.error(errorCode);
            console.error(errorMessage);
      });




}




function fnRegistro() {


// cada un@ pone su magia para recuperar el mail y la clave de un form...
    emailDelUser = $$('#rEmail').val();
    passDelUser = $$('#rPass').val();


    firebase.auth().createUserWithEmailAndPassword(emailDelUser, passDelUser)
      .then((userCredential) => {
        // Signed in
        var user = userCredential.user;
        console.log("Bienvenid@!!! " + emailDelUser);
        // ...
        //mainView.router.navigate('/siguientePantallaDeUsuarioOK/');


        claveDeColeccion = emailDelUser;

        nombre = $$('#rNombre').val();

        datos = {
            nombre: nombre,
            rol: "usuario"
        }

        colUsuario.doc(claveDeColeccion).set(datos)
        .then(() => {
            console.log("Document successfully written!");
        })
        .catch((error) => {
            console.error("Error writing document: ", error);
        });


      })
      .catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;

        console.error(errorCode);
        console.error(errorMessage);

        if (errorCode == "auth/email-already-in-use") {
            console.error("el mail ya esta usado");
        }

        // ..
      });



}





</script>

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="lib/framework7/framework7-bundle.min.js"></script>
    <!--<script type="text/javascript" src="lib/framework7/framework7.js"></script>-->
    <script type="text/javascript" src="js/my-app.js"></script>
</body>

</html>
